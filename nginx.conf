server {
    listen 8080 default_server;
    listen [::]:8080 default_server;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Regular Ubuntu archive
    location /ubuntu/ {
        alias /var/spool/apt-mirror/mirror/archive.ubuntu.com/ubuntu/;
        autoindex on;
    }

    # Security archive
    location /ubuntu-security/ {
        alias /var/spool/apt-mirror/mirror/security.ubuntu.com/ubuntu/;
        autoindex on;
    }

    # Health check
    location = /healthz {
        return 200 'ok';
    }

    # Block everything else to avoid serving the raw spool by mistake.
    location / {
        return 404;
    }
}
